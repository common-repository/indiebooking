var indiebookingCountdownController=function(o,n){function e(){r();var o=n("#bookingPostId").val(),e=n.ajax({type:"POST",dataType:"json",url:indiebooking_frontend_ajaxObject.ajaxURL,async:!1,data:{action:"bookingOutOfTime",bookingId:o,security:indiebooking_frontend_ajaxObject.ib_ajax_nonce},beforeSend:function(o){window.indiebookingGlobalFrontendUiController.showFullLoading()}});e.done(function(o,n,e){window.location.reload()}),e.fail(function(o,n,e){window.indiebookingGlobalFrontendUiController.errorBookingDialog(rs_ib_global_txt_Error,e)}),e.always(function(){window.indiebookingGlobalFrontendUiController.hideFullLoading()})}function a(){window.clearTimeout(_)}function i(){b=setInterval(function(){l()},6e4)}function r(){clearTimeout(b)}function l(){if(bookingId=n("#bookingPostId").val(),"undefined"==typeof bookingId||0==bookingId||bookingId<=0)r();else{n.ajax({type:"POST",url:indiebooking_frontend_ajaxObject.ajaxURL,data:{action:"indiebookingHeartbeat",bookingId:bookingId,security:indiebooking_frontend_ajaxObject.ib_ajax_nonce}})}}function c(o,n){null!==document.getElementById(n)&&(t=o,d=Math.floor(t/86400)%24,h=Math.floor(t/3600)%24,m=Math.floor(t/60)%60,s=t%60,d=d>0?d+"d ":"",h=h<10?"0"+h:h,m=m<10?"0"+m:m,s=s<10?"0"+s:s,strZeit=d+h+":"+m+":"+s,o>0?(parseInt(o)<=60&&window.indiebookingGlobalBookingController.showOutofTimeBookingDialog(),_=window.setTimeout(function(){c(--o,n)},1e3)):e(),document.getElementById(n).innerHTML=strZeit)}var _,b;return{countdown:c,stopCountdown:a,indiebookingStartHeartbeat:i,indiebookingStopHeartbeat:r}}(window,jQuery);window.indiebookingCountdownController||(window.indiebookingCountdownController=indiebookingCountdownController);var indiebookingGlobalFrontendUiController=function(o,n){function e(){var e={},t=n("#bookingPostId").val();if(parseInt(t)>0){e=o.indiebookingGlobalBookingController.getBookingInfos();var a=n.ajax({type:"POST",url:indiebooking_frontend_indiebooking_frontend_ajaxObject.ajaxURL,data:{action:"updateBookingOptions",bookingObj:e,bookingId:t,security:indiebooking_frontend_indiebooking_frontend_ajaxObject.ib_ajax_nonce},beforeSend:function(n){o.indiebookingGlobalFrontendUiController.showFullLoading()}});a.done(function(n,e,t){o.indiebookingGlobalFrontendUiController.refreshMainContainerIfHtml(n,e,t)}),a.fail(function(n,e,t){o.indiebookingGlobalFrontendUiController.errorBookingDialog(rs_ib_global_txt_Error,t)}),a.always(function(){o.indiebookingGlobalFrontendUiController.hideFullLoading()})}}function t(o,e){var t=o.closest(e).find(".rewa_datepicker");n(t).val("")}function a(){var o=n("body").find(".zabuto_calendar");n(o).each(function(){var o=n(this).closest(".rs_ib_calendar_data_container"),e="#"+n(o).attr("id"),t=n(e);n(t.data("clearCalendar")())})}function i(e){var t="";"undefined"!=typeof e&&e!==!1&&e>1&&(t=e);var a="#search_booking_date_from"+t,i="#search_booking_date_to"+t,r="#rs_ib_search_by_ajax_kz"+t,l="#search_categorie"+t,d="#search_anzahl_betten"+t,s="#search_anzahl_zimmer"+t,c="#search_anzahl_personen"+t,_="#rs_ib_region_input"+t,b="#search_features"+t,u="",g="",p="",f="",k="",h="",m="",v="",y="";n(a).length>0&&(u=n(a).val()),n(i).length>0&&(g=n(i).val()),n(r).length>0&&(p=n(r).val()),n(l).length>0&&(f=n(l).val()),n(d).length>0&&(k=n(d).val()),n(s).length>0&&(h=n(s).val()),n(c).length>0&&(m=n(c).val()),n(_).length>0&&(v=n(_).val()),n(b).length>0&&(y=n(b).val());var C=n("[name='rs_indiebooking_frontend_option_filter']"),x=[];if(n.each(C,function(o,e){n(e).is(":checked")&&x.push(n(e).val())}),"true"===p){var j=n.ajax({type:"POST",url:indiebooking_frontend_ajaxObject.ajaxURL,data:{action:"search_appartments",searchDateFrom:u,searchDateTo:g,searchCategorie:f,searchNrOfBeds:k,searchNrOfRooms:h,searchNrOfGuest:m,searchOptions:x,searchLocation:v,searchFeatures:y,security:indiebooking_frontend_ajaxObject.ib_ajax_nonce},beforeSend:function(n){o.indiebookingGlobalFrontendUiController.showFullLoading()}});j.done(function(o,e,t){n("#btnBookMore").hide(),n("#found_appartment_list").html(o),showZabutoCalendars()}),j.fail(function(n,e,t){o.indiebookingGlobalFrontendUiController.errorBookingDialog("",t)}),j.always(function(){indiebookingGlobalUiController.lazyLoadImages(),o.indiebookingGlobalFrontendUiController.hideFullLoading()})}else{var w="post",O=n("#rs_ib_search_page_link").val(),B=O,G=document.createElement("form");G.setAttribute("method",w),G.setAttribute("action",B);var I={search_booking_date_from:u,search_booking_date_to:g,search_category:f,search_nr_of_beds:k,search_nr_of_guest:m,search_nr_of_rooms:h,search_location:v,search_features:y};for(var D in I)if(I.hasOwnProperty(D)){var F=document.createElement("input");F.setAttribute("type","hidden"),F.setAttribute("name",D),F.setAttribute("value",I[D]),G.appendChild(F)}document.body.appendChild(G),G.submit()}}function r(e,t,a){var i=a.getResponseHeader("content-type")||"";i.indexOf("html")>-1&&(n("#page_content div.main_container div.row").html(e),"function"==typeof rs_indiebooking_initPayPalBasicButton&&rs_indiebooking_initPayPalBasicButton(),"function"==typeof rs_indiebooking_initPayPalExpressButton&&rs_indiebooking_initPayPalExpressButton()),i.indexOf("json")>-1&&0==e.success&&o.indiebookingGlobalFrontendUiController.errorBookingDialog("",e.data.MSG)}function l(e){var t=[],a=n("#contact_data_box").find(".fkt_contact_field");return n.each(a,function(o,a){if("1"==n(a).attr("data-required")&&""===e[n(a).attr("data-settingsname")].trim()){var i=n(a).attr("data-errorname");t.push(i)}}),1==e.altAdress&&(""===e.name2.trim(),""===e.firstName2.trim(),""===e.strasse2.trim()&&t.push("strasse2"),""===e.ort2&&t.push("ort2"),""===e.email2,""===e.telefon2,""===e.plz2&&t.push("plz2"),""===e.anrede2,e.strasseNr2.length>10&&t.push("strasseNr2"),""===e.country2&&t.push("country2")),!(t.length>0)||(o.indiebookingGlobalFrontendUiController.displayContactError(t),!1)}function d(){var o={},e=!1,t=n("#contact_data_box").find(".fkt_contact_field");return n.each(t,function(e,t){o[n(t).attr("data-settingsname")]=n(t).val().trim()}),n("#useAlternateBillingAdressCb").is(":checked")&&(e=!0),o.altAdress=e,o.titel2=n("#kontakt_title2").val().trim(),o.firma2=n("#kontakt_firma2").val().trim(),o.abteilung2=n("#kontakt_abteilung2").val().trim(),o.anrede2=n("#kontakt_anrede2").val().trim(),o.name2=n("#kontakt_name2").val().trim(),o.firstName2=n("#kontakt_first_name2").val().trim(),o.strasse2=n("#route2").val().trim(),o.ort2=n("#locality2").val().trim(),o.plz2=n("#postal_code2").val().trim(),o.strasseNr2=n("#street_number2").val().trim(),o.country2=n("#country2").val().trim(),o.email2=n("#kontakt_email2").val().trim(),o.telefon2=n("#kontakt_telefon2").val().trim(),o}function s(o){var e=!1,t=!1,a=!1,i=!1,r=!1,l=!1,d=!1,s=!1,c=!1,_=!1,b=!1,u=!1,g=!1,p=!1,f=!1,k=!1,h=!1,m=!1,v=!1,y=!1,C=!1,x=!1,j=!1,w=!1,O="1px solid red",B="1px solid #ccc";console.log(o),n.each(o,function(o,G){"title"==G&&(n("#err_title").show(),n("#kontakt_title").css("border",O),s=!0),"anrede"==G&&(n("#err_anrede").show(),n("#kontakt_anrede").css("border",O),c=!0),"department"==G?(n("#err_abteilung").show(),n("#kontakt_abteilung").css("border",O),g=!0):0==g&&(n("#err_abteilung").hide(),n("#kontakt_abteilung").css("border",B)),"firma"==G?(n("#err_firma").show(),n("#kontakt_firma").css("border",O),u=!0):0==u&&(n("#err_firma").hide(),n("#kontakt_firma").css("border",B)),"email"==G?(n("#err_email").show(),n("#kontakt_email").css("border",O),e=!0):0==e&&(n("#err_email").hide(),n("#kontakt_email").css("border",B)),"firstName"==G?(n("#err_text_first_name").show(),n("#kontakt_first_name").css("border",O),a=!0):0==a&&(n("#err_text_first_name").hide(),n("#kontakt_first_name").css("border",B)),"name"==G?(n("#err_text_name").show(),n("#kontakt_name").css("border",O),t=!0):0==t&&(n("#err_text_name").hide(),n("#kontakt_name").css("border",B)),"strasse"==G?(n("#err_street").show(),n("#route").css("border",O),i=!0):0==i&&(n("#err_street").hide(),n("#route").css("border",B)),"plz"==G?(n("#err_zip_code").show(),n("#postal_code").css("border",O),r=!0):0==r&&(n("#err_zip_code").hide(),n("#postal_code").css("border",B)),"ort"==G?(n("#err_location").show(),n("#locality").css("border",O),l=!0):0==l&&(n("#err_location").hide(),n("#locality").css("border",B)),"telefon"==G?(n("#err_telefon").show(),n("#kontakt_telefon").css("border",O),d=!0):0==d&&(n("#err_telefon").hide(),n("#kontakt_telefon").css("border",B)),"country"==G?(n("#err_country").show(),n("#country").css("border",O),_=!0):0==_&&(n("#err_country").hide(),n("#country").css("border",B)),"strasseNr"==G?(n("#err_hausnr").show(),n("#street_number").css("border",O),b=!0):0==b&&(n("#err_hausnr").hide(),n("#street_number").css("border",B)),"title2"==G&&(n("#err_title2").show(),n("#kontakt_title2").css("border",O),C=!0),"anrede2"==G&&(n("#err_anrede2").show(),n("#kontakt_anrede2").css("border",O),x=!0),"email2"==G?(n("#err_email2").show(),n("#kontakt_email2").css("border",O),p=!0):0==p&&(n("#err_email2").hide(),n("#kontakt_email2").css("border",B)),"firstName2"==G?(n("#err_text_first_name2").show(),n("#kontakt_first_name2").css("border",O),k=!0):0==k&&(n("#err_text_first_name2").hide(),n("#kontakt_first_name2").css("border",B)),"name2"==G?(n("#err_text_name2").show(),n("#kontakt_name2").css("border",O),f=!0):0==f&&(n("#err_text_name2").hide(),n("#kontakt_name2").css("border",B)),"strasse2"==G?(n("#err_street2").show(),n("#route2").css("border",O),h=!0):0==h&&(n("#err_street2").hide(),n("#route2").css("border",B)),"plz2"==G?(n("#err_zip_code2").show(),n("#postal_code2").css("border",O),m=!0):0==m&&(n("#err_zip_code2").hide(),n("#postal_code2").css("border",B)),"ort2"==G?(n("#err_location2").show(),n("#locality2").css("border",O),v=!0):0==v&&(n("#err_location2").hide(),n("#locality2").css("border",B)),"telefon2"==G?(n("#err_telefon2").show(),n("#kontakt_telefon2").css("border",O),y=!0):0==y&&(n("#err_telefon2").hide(),n("#kontakt_telefon2").css("border",B)),"country2"==G?(n("#err_country2").show(),n("#country2").css("border",O),j=!0):0==j&&(n("#err_country2").hide(),n("#country2").css("border",B)),"strasseNr2"==G?(n("#err_hausnr2").show(),n("#street_number2").css("border",O),w=!0):0==w&&(n("#err_hausnr2").hide(),n("#street_number2").css("border",B))})}function c(o){n(o).addClass("loading")}function _(o){n(o).removeClass("loading")}function b(){n("body").addClass("loading")}function u(){n("body").hasClass("loading")&&(n.active>0?o.setTimeout(u,200):n("body").removeClass("loading"))}function g(){var o=n("#rs_ib_link_to_start_page").val();o&&(location.href=o)}function p(){var o=n("#rs_ib_link_to_start_page").val();o&&(o.indexOf("?")==-1?location.href=o+"?bookingsuccess=true":location.href=o+"&bookingsuccess=true")}function f(o,e){"undefined"!=typeof e&&0!=e||(e=""),n("#page_content").append('<div id="errorDlg"><h6>'+e+"</h6></div>");n("#errorDlg").dialog({autoOpen:!1,modal:!0,title:o,zIndex:1e4,resizable:!1,close:function(o,e){n("#errorDlg").remove()}}),n("#errorDlg").dialog("open")}return n(document).ready(function(){n(".ibfkt_indiebooking_searchApartmentBtn").on("click",function(o){o.preventDefault();var e=n(this).attr("data-ib-startpagenumber");i(e)}),n(document).on("click",".remove_datepicker_date",function(){t(n(this),"div"),a()}),n(document).on("click",".remove_datepicker_date_2",function(){t(n(this),"tr")}),n(document).on("click","#booking_overview_box .cb_choose_option",function(){e()})}),{rs_indiebooking_getPageContactData:d,displayContactError:s,refreshMainContainerIfHtml:r,checkKontaktData:l,showFullLoading:b,hideFullLoading:u,showPartLoading:c,hidePartLoading:_,errorBookingDialog:f,returnToStartPage_3:p,returnToStartPage_4:g}}(window,jQuery);window.indiebookingGlobalFrontendUiController||(window.indiebookingGlobalFrontendUiController=indiebookingGlobalFrontendUiController);var indiebookingGlobalBookingController=function(o,n){function e(n,e){try{"undefined"!=typeof e&&"undefined"!=e||(e=!1);var t=c(n,e);_(t,n)}catch(a){o.indiebookingGlobalFrontendUiController.errorBookingDialog(rs_ib_global_txt_Error,a)}}function t(){var e=n("#bookingPostId").val(),t=n("#payPal_paymentId").val(),a=n("#payPal_token").val(),i=n("#payPal_payerId").val(),r=n("#btnAppartmentZahlungspflichtigBuchen").data("data-orderreferenceid"),l=n("#rs_indiebooking_booking_custom_message").val(),d=!1;if(n("#ctrl_agree").length>0&&n("#ctrl_agree").is(":checked")&&(d=!0),d){var s=n.ajax({type:"POST",url:indiebooking_frontend_ajaxObject.ajaxURL,data:{action:"finalizeBooking",bookingId:e,paymentId:t,paypalToken:a,payPalPayerId:i,customMessage:l,amznOrderRefId:r,security:indiebooking_frontend_ajaxObject.ib_ajax_nonce},beforeSend:function(n){o.indiebookingGlobalFrontendUiController.showFullLoading()}});s.done(function(n,e,t){var a=t.getResponseHeader("content-type")||"";"undefined"!=typeof n.data&&n.data!==!1&&"undefined"!=typeof n.data.SUCCESSPAGE&&""!=n.data.SUCCESSPAGE?o.location=n.data.SUCCESSPAGE:(a.indexOf("html")>-1&&o.indiebookingGlobalFrontendUiController.refreshMainContainerIfHtml(n,e,t),a.indexOf("json")>-1&&0==n.success&&o.indiebookingGlobalFrontendUiController.errorBookingDialog(rs_ib_global_txt_Error,n.data.MSG),o.setTimeout("window.indiebookingGlobalFrontendUiController.returnToStartPage_3()",5e3))}),s.fail(function(n,e,t){o.indiebookingGlobalFrontendUiController.errorBookingDialog(rs_ib_global_txt_Error,t)}),s.always(function(){o.indiebookingGlobalFrontendUiController.hideFullLoading()})}else n("#ctrl_agree").popover("show")}function a(e,t){var a=n.ajax({type:"POST",url:indiebooking_frontend_ajaxObject.ajaxURL,data:{action:"fetchRemainingTime",resettime:t,bookingPostId:e.bookingPostId},beforeSend:function(n){t&&o.indiebookingGlobalFrontendUiController.showFullLoading()}});a.done(function(n,e,t){1==n.data.success&&(remainingTime=n.data.remainingTime,0!=remainingTime&&(o.indiebookingCountdownController.stopCountdown(),o.indiebookingCountdownController.countdown(remainingTime,"countdownBooking_2"),o.indiebookingGlobalBookingController.countDownOutOfTimeWasShown=!1))}),a.always(function(){o.indiebookingGlobalFrontendUiController.hideFullLoading()})}function i(e,t){var i={},r={},s=!0,c="",_=!0,b=n("#bookingPostId").val(),u=n("#booking_status_box_menu").attr("data-pageKz"),g="";if("undefined"!=typeof e&&e!==!1||(e=0),"undefined"!=typeof t&&t!==!1||(t={}),g=indiebooking_language.language,parseInt(b)>0)if(r=o.indiebookingGlobalBookingController.getBookingInfos(),r.clickedOption=t,1==u?0==e&&(e=1):2==u&&(0==e&&(e=2),i=o.indiebookingGlobalFrontendUiController.rs_indiebooking_getPageContactData(),s=o.indiebookingGlobalFrontendUiController.checkKontaktData(i),n("#useAlternateBillingAdressCb").is("checked"),c=n("#rs_indiebooking_ppplus_container").length>0?"Paypal":n("input[type='radio'][name='rs_ib_Zahlmethode']:checked").val()),r.arrivalDaysOk&&s){var p=n.ajax({type:"POST",url:indiebooking_frontend_ajaxObject.ajaxURL,data:{action:"updateBooking",bookingObj:r,pageKz:u,bookContact:i,paymentMethod:c,toPageKz:e,security:indiebooking_frontend_ajaxObject.ib_ajax_nonce,ib_lang:g},beforeSend:function(t){e>=0?o.indiebookingGlobalFrontendUiController.showFullLoading():(n("#current_price_box_data").hide(),o.indiebookingGlobalFrontendUiController.showPartLoading("#current_price_box"),o.indiebookingGlobalFrontendUiController.showPartLoading("#rightControllContainer"),n("#rightControllContainer").find(".right_button").hide())}});p.done(function(t,a,i){var r=i.getResponseHeader("content-type")||"",s=!1;if(r.indexOf("html")>-1)e!=-1&&(1==e&&d(),n("#rs_indiebooking_ppplus_container").length>0?null!=rs_indiebooking_paypal_plus_btn&&rs_indiebooking_paypal_plus_do_payment():(o.indiebookingGlobalFrontendUiController.refreshMainContainerIfHtml(t,a,i),n("#rs_indiebooking_ppplus_container").length>0&&rs_indiebooking_init_ppplus())),s=!0;else if(r.indexOf("json")>-1){if(0==t.success&&2!=u)"STOPBOOKING"in t.data&&1==t.data.STOPBOOKING&&(_=!1),o.indiebookingGlobalFrontendUiController.hideFullLoading(),o.indiebookingGlobalFrontendUiController.errorBookingDialog(rs_ib_global_txt_Error,t.data.MSG);else if(0==t.success&&2==u){var c=t.data.FIELDS;o.indiebookingGlobalFrontendUiController.displayContactError(c)}else 1==t.success&&99==u&&o.location.replace(t.data.PERMALINK);if(0==t.success&&2==u&&o.indiebookingGlobalFrontendUiController.displayContactError(c),e==-1&&(s=!0),"undefined"!=typeof t.data.notValidOptions){var b=t.data.notValidOptions;n.each(b,function(o,e){var t=n("body").find(".appartment_box[data-appartmentid='"+o+"']"),a=n(t).find(".appartmentOptionsBox").find(".cb_choose_option[data-optionid='"+e+"']");n(a).prop("checked",!1)})}}if(s){l();var g=n("#appartment_list_box").find(".apartment_detail_buchen").find(".zabuto_calendar").find("td.event-styled").find(".booked_last_disabled");n(g).removeClass("booked_last_disabled"),n(g).addClass("bookedenabled")}}),p.fail(function(n,e,t){o.indiebookingGlobalFrontendUiController.errorBookingDialog(rs_ib_global_txt_Error,t)}),p.always(function(){_?a(r,!1):location.reload(),e>=0?o.indiebookingGlobalFrontendUiController.hideFullLoading():(n("#rightControllContainer").find(".right_button").show(),o.indiebookingGlobalFrontendUiController.hidePartLoading("#rightControllContainer"),n("#current_price_box_data").show())})}else if(!r.arrivalDaysOk)return n.each(r.appartments,function(o,e){if(0==e.arrivalDayOk){var t=n("#appartment_list_box").find("[data-appartmentid='"+e.id+"']"),a=n(t).find(".moreBookingInfoBox").find(".booking_date_from");if(n(a).hasClass("rs_ib_error_popover")){n(a).addClass("rs_ib_wrongarrivalday");var i=n(a).parent("div").find(".rs_ib_msg_wrong_arrival_day").val();n(a).popover({placement:"top",trigger:"manual",content:function(){return i}}),n(a).data("bs.popover").options.content=i,n(a).popover("show")}}}),o.indiebookingGlobalFrontendUiController.errorBookingDialog("Achtung","Ein oder mehrere Ankunftstage sind nicht mÃ¶glich"),!1;return s}function r(){var e=[],t={},a=0;n("#bookingPostId")&&(a=n("#bookingPostId").val());var i=!0,r=(n(".cb_choose_option"),n(".appartment_box").find(".rsappartment_buchung"));return n.each(r,function(t,a){var r={},l=n(a).find(".moreBookingInfoBox").find(".date_container");l=l.attr("data-arrivaldays"),l=JSON.parse(l);var d=n(a).find(".moreBookingInfoBox").find(".cb_choose_option"),s=[];r.id=n(a).attr("data-appartmentId"),r.buchungVon=n(a).find(".date_container").find(".booking_date_from").val(),r.buchungBis=n(a).find(".date_container").find(".booking_date_to").val(),r.arrivalDayOk=o.indiebookingDateUtil.getInstance().checkArrivalDay(r.buchungVon,l),0==r.arrivalDayOk&&(i=!1),r.anzPers=n(a).find(".rs_ib_buchung_anzahl_personen").val(),n.each(d,function(o,e){if(n(e).is(":checked")){var t=n(this).closest("tr");if(t.length)var a=t.attr("data-optionId");else var a=n(e).attr("data-optionId");s.push(a)}}),r.options=s,e.push(r)}),t.bookingPostId=a,t.appartments=e,t.arrivalDaysOk=i,t}function l(){if(n("#current_price_box").length){var e=n("#bookingPostId").val(),t=n.ajax({type:"POST",url:indiebooking_frontend_ajaxObject.ajaxURL,data:{action:"returnCurrentPrice",bookingId:e,security:indiebooking_frontend_ajaxObject.ib_ajax_nonce},beforeSend:function(e){n("#current_price_box_data").html(""),o.indiebookingGlobalFrontendUiController.showPartLoading("#current_price_box")}});t.done(function(o,e,t){var a=t.getResponseHeader("content-type")||"";a.indexOf("html")>-1&&n("#current_price_box_data").html(o)}),t.fail(function(o,n,e){console.log(e)}),t.always(function(){o.indiebookingGlobalFrontendUiController.hidePartLoading("#current_price_box")})}}function d(){var o=document.getElementsByTagName("head")[0],n=document.createElement("script"),e=ib_google_api.apikey;""!=e&&(n.type="text/javascript",n.src="https://maps.googleapis.com/maps/api/js?key="+e+"&signed_in=true&libraries=places&callback=initAutocomplete",o.appendChild(n))}function s(e){var t=n("#bookingPostId").val(),a=n("#booking_status_box_menu").attr("data-pageKz");if(parseInt(t)>0&&parseInt(a)<4){switch(e){case 1:break;case 2:break;case 3:}var i=n.ajax({type:"POST",url:indiebooking_frontend_ajaxObject.ajaxURL,data:{action:"updateBookingStatus",bookingId:t,toPageKz:e,pageKz:a,security:indiebooking_frontend_ajaxObject.ib_ajax_nonce},beforeSend:function(n){o.indiebookingGlobalFrontendUiController.showFullLoading()}});i.done(function(n,e,t){o.location.reload(!0)})}}function c(o,e){var t,a,i,r,l=new Array,d=new Array,s=new Array,c=1,_=0,b=0,u={};rs_indiebooking_booking_txt.no_valid_date;if(o)if(e){_=n("#search_booking_date_from").val(),b=n("#search_booking_date_to").val();var g={},p="#ib_book_apartment_"+e;a=n(p).closest(".rs_ib_apartmentItem").find(".item_uebersicht").find(".rs_zabuto-calendar"),c=n("#search_anzahl_personen").val(),g.anzPers=c,d.push(e),g.fromDate=n(a).data("firstdate"),g.toDate=n(a).data("lastdate"),"undefined"!=typeof g.fromDate&&""!=g.fromDate||(g.fromDate=_),"undefined"!=typeof g.toDate&&""!=g.toDate||(g.toDate=b),g.apartmentId=e,g.optionIds=new Array,l.push(g)}else{var g={};d.push(n("#appartmentPostId").val()),r=n(".cb_choose_option"),_=n(".booking_date_from").val(),b=n(".booking_date_to").val(),g.anzPers=n(".rs_ib_buchung_anzahl_personen").val(),g.apartmentId=n("#appartmentPostId").val(),g.fromDate=_,g.toDate=b,n.each(r,function(o,e){if(n(this).is(":checked")){var t=n(this).attr("data-optionid");s.push(t)}}),"undefined"==typeof g.fromDate||""==g.fromDate||"undefined"==typeof g.toDate||""==g.toDate,g.optionIds=s,l.push(g)}else t=n(".appartmentauswahl_checkbox"),_=n("#search_booking_date_from").val(),b=n("#search_booking_date_to").val(),c=n("#search_anzahl_personen").val(),n.each(t,function(o,e){var t={};i=n(e).is(":checked"),i&&(a=n(e).closest(".rs_ib_apartmentItem").find(".item_uebersicht").find(".rs_zabuto-calendar"),t.apartmentId=n(e).attr("data-appartmentId"),t.fromDate=n(a).data("firstdate"),t.toDate=n(a).data("lastdate"),t.anzPers=c,"undefined"!=typeof t.fromDate&&""!=t.fromDate||(t.fromDate=_),"undefined"!=typeof t.toDate&&""!=t.toDate||(t.toDate=b),t.optionIds=new Array,l.push(t),d.push(n(e).attr("data-appartmentId")),"undefined"==typeof t.fromDate||""==t.fromDate||"undefined"==typeof t.toDate||""==t.toDate)});return u.appartmentIds=d,u.allOptionIds=s,u.dateFrom=_,u.dateTo=b,u.apartmentBuchungen=l,u}function _(e,t){var a=!0,i=0;if(t&&(i=n("#bookingPostId").val(),i>0&&(a=!1)),a){var r=n.ajax({type:"POST",dataType:"json",url:indiebooking_frontend_ajaxObject.ajaxURL,data:{action:"createDummyBooking",bookingInfosObj:e,security:indiebooking_frontend_ajaxObject.ib_ajax_nonce},beforeSend:function(n){o.indiebookingGlobalFrontendUiController.showFullLoading()}});r.done(function(e,a,i){if(1===parseInt(e.data.CODE))t?o.location.replace(e.data.PERMALINK):o.location.replace(e.data.PERMALINK);else{if("undefined"!=typeof e.data.notValidOptions){var r=e.data.notValidOptions;n.each(r,function(o,e){var t=n("body").find(".appartment_box[data-appartmentid='"+o+"']"),a=n(t).find(".appartmentOptionsBox").find(".cb_choose_option[data-optionid='"+e+"']");n(a).prop("checked",!1)})}o.indiebookingGlobalFrontendUiController.errorBookingDialog(rs_ib_global_txt_Error,e.data.MSG)}}),r.fail(function(n,e,t){return o.indiebookingGlobalFrontendUiController.errorBookingDialog(rs_ib_global_txt_Error,t),null}),r.always(function(){o.indiebookingGlobalFrontendUiController.hideFullLoading()})}else o.indiebookingGlobalBookingController.updateBooking()}function b(){var e=n("#apartment_coupon_code").val(),t=n("#appartmentPostId").val(),a=n("#booking_date_from").val(),i=n("#booking_date_to").val(),r=n("#bookingPostId").val();n("#apartment_coupon_code").val(""),n("#apartment_coupon_code").length>0&&(n("#apartment_coupon_code").popover("hide"),n("#apartment_coupon_code").popover("destroy"));var l=n.ajax({type:"POST",url:indiebooking_frontend_ajaxObject.ajaxURL,data:{action:"checkApartmentCouponCode",couponCode:e,appartmentId:t,fromDate:a,toDate:i,buchungId:r,smallCouponCheck:!1,security:indiebooking_frontend_ajaxObject.ib_ajax_nonce},beforeSend:function(n){o.indiebookingGlobalFrontendUiController.showFullLoading()}});l.done(function(e,t,a){"success"==t||1==e.success?o.indiebookingGlobalFrontendUiController.refreshMainContainerIfHtml(e,t,a):n("#apartment_coupon_code").length>0&&(""!==e.data.MSG&&n("#apartment_coupon_code").popover({content:e.data.MSG,placement:"top",trigger:"manual"}),n("#apartment_coupon_code").popover("show"))}),l.fail(function(n,e,t){o.indiebookingGlobalFrontendUiController.errorBookingDialog("",t)}),l.always(function(){o.indiebookingGlobalFrontendUiController.hideFullLoading()})}function u(){n("#apartment_coupon_code_small").length>0&&(n("#apartment_coupon_code_small").popover("hide"),n("#apartment_coupon_code_small").popover("destroy"));var e=n("#apartment_coupon_code_small").val(),t=n("#appartmentPostId").val(),a=n("#booking_date_from").val(),i=n("#booking_date_to").val(),r=n("#bookingPostId").val();n("#apartment_coupon_code_small").val("");var d=n.ajax({type:"POST",url:indiebooking_frontend_ajaxObject.ajaxURL,data:{action:"checkApartmentCouponCode",couponCode:e,appartmentId:t,fromDate:a,toDate:i,buchungId:r,smallCouponCheck:!0,security:indiebooking_frontend_ajaxObject.ib_ajax_nonce},beforeSend:function(n){o.indiebookingGlobalFrontendUiController.showFullLoading()}});d.done(function(o,e,t){var a=t.getResponseHeader("content-type")||"";a.indexOf("html")>-1||1==o.success?l():n("#apartment_coupon_code_small").length>0&&(""!==o.data.MSG&&(console.log(o.data.MSG),n("#apartment_coupon_code_small").popover({content:o.data.MSG,placement:"top",trigger:"manual"})),n("#apartment_coupon_code_small").popover("show"))}),d.fail(function(n,e,t){o.indiebookingGlobalFrontendUiController.errorBookingDialog("",t)}),d.always(function(){o.indiebookingGlobalFrontendUiController.hideFullLoading()})}function g(){var e=n("#bookingPostId").val(),t=!1;if(n("#ctrl_agree").length>0&&n("#ctrl_agree").is(":checked")&&(t=!0),t){var a=n.ajax({type:"POST",url:indiebooking_frontend_ajaxObject.ajaxURL,data:{action:"finalizeInquiry",bookingId:e,security:indiebooking_frontend_ajaxObject.ib_ajax_nonce},beforeSend:function(n){o.indiebookingGlobalFrontendUiController.showFullLoading()}});a.done(function(n,e,t){var a=t.getResponseHeader("content-type")||"";"undefined"!=typeof n.data&&1==n.success&&n.data!==!1&&""!=n.data.SUCCESSPAGE?o.location=n.data.SUCCESSPAGE:(a.indexOf("html")>-1&&(o.indiebookingGlobalFrontendUiController.refreshMainContainerIfHtml(n,e,t),o.setTimeout("window.indiebookingGlobalFrontendUiController.returnToStartPage_3()",5e3)),a.indexOf("json")>-1&&0==n.success&&o.indiebookingGlobalFrontendUiController.errorBookingDialog(rs_ib_global_txt_Error,n.data.MSG))}),a.fail(function(n,e,t){o.indiebookingGlobalFrontendUiController.errorBookingDialog(rs_ib_global_txt_Error,t)}),a.always(function(){o.indiebookingGlobalFrontendUiController.hideFullLoading()})}else n("#ctrl_agree").popover("show")}function p(){if(!o.indiebookingGlobalBookingController.countDownOutOfTimeWasShown){o.indiebookingGlobalBookingController.countDownOutOfTimeWasShown=!0,n("#page_content").append('<div id="yesNoOutOfTimeDlg" class="ibui_widget"><div class="ibui_h2wrap"><h2 class="ibui_h2">'+rs_indiebooking_translation_txt.attention+"</h2>"+rs_indiebooking_translation_txt.almostOutOfTime+"</div></div>");n("#yesNoOutOfTimeDlg").dialog({autoOpen:!1,modal:!0,title:"",zIndex:1e4,resizable:!1,buttons:{SaveButton:{text:"OK","class":"rs_ib_fkt_resettimeout",click:function(){var e=(n("#bookingPostId").val(),o.indiebookingGlobalBookingController.getBookingInfos());a(e,!0),n(this).dialog("close")}}},close:function(o,e){n("#yesNoOutOfTimeDlg").remove()}}),n("#yesNoOutOfTimeDlg").dialog("open")}}function f(o){"undefined"!=typeof o&&0!=o||(o=""),n("#page_content").append('<div id="yesNoDlg"><h6>'+rs_ib_global_txt_sicherAbfrage_CancelBooking+"</h6></div>");n("#yesNoDlg").dialog({autoOpen:!1,modal:!0,title:rs_ib_global_txt_sicherAbfrage,zIndex:1e4,minWidth:350,resizable:!1,buttons:[{text:rs_ib_global_btn_Yes,click:function(){var e=n("#bookingPostId").val();h(e,o),n(this).dialog("close")}},{text:rs_ib_global_btn_No,click:function(){n(this).dialog("close")}}],close:function(o,e){n("#yesNoDlg").remove()}}),n("#yesNoDlg").dialog("open")}function k(e){n("#booking_status_box_menu").length>0&&"4"!=n("#booking_status_box_menu").attr("data-pagekz")?f(e):o.location=e}function h(e,t){"undefined"==typeof t&&0==t&&(t="");var a=n.ajax({type:"POST",url:indiebooking_frontend_ajaxObject.ajaxURL,data:{action:"cancelBooking",bookingId:e,security:indiebooking_frontend_ajaxObject.ib_ajax_nonce},beforeSend:function(n){o.indiebookingGlobalFrontendUiController.showFullLoading()}});a.done(function(n,e,a){""==t?o.location.reload():o.location=t}),a.fail(function(n,e,t){o.indiebookingGlobalFrontendUiController.errorBookingDialog("",t)}),a.always(function(){o.indiebookingGlobalFrontendUiController.hideFullLoading()})}function m(){var n=o.indiebookingGlobalBookingController.updateBooking();1==n&&o.scrollTo(0,0)}function v(o,n){}function y(e,t){var a=n.ajax({type:"POST",url:indiebooking_frontend_ajaxObject.ajaxURL,data:{action:"cancelBooking",bookingNr:t,emailadr:e,security:indiebooking_frontend_ajaxObject.ib_ajax_nonce},beforeSend:function(n){o.indiebookingGlobalFrontendUiController.showFullLoading()}});a.done(function(o,e,t){var a="";1==o.data.CODE?(a="<p class='success'>"+o.data.MSG+"</p>",n("#usercancel_email_adress").val(""),n("#usercancel_bookingnumber").val("")):a="<p class='fail'>"+o.data.MSG+"</p>",n("#error_success_msg").html(a)}),a.fail(function(n,e,t){o.indiebookingGlobalFrontendUiController.errorBookingDialog("",t)}),a.always(function(){o.indiebookingGlobalFrontendUiController.hideFullLoading()})}function C(){var o=n("#appartment_list_box").find(".appartment_box");n.each(o,function(o,e){var t=(n(e).attr("data-appartmentid"),n(e).find(".appartmentOptionsBox")),a=n(t).find(".checkbox");n.each(a,function(o,t){var a=!0,i=n(t).attr("data-cond"),r=n(t).attr("data-condvalue");if(0==i)a=!0;else{var l=n(e).find(".booking_date_from").val(),d=n(e).find(".booking_date_to").val();if(""!=l&&""!=d){var s=l.split("."),c=d.split("."),_=new Date(Date.UTC(parseInt(s[2]),parseInt(s[1])-1,parseInt(s[0]))),b=new Date(Date.UTC(parseInt(c[2]),parseInt(c[1]-1),parseInt(c[0]))),u=new Date(b-_),g=u/1e3/60/60/24;1==i?a=g>=r:3==i&&(a=g<=r)}}a?n(t).show():n(t).hide()})})}var x=!1;return n(document).on("heartbeat-send",function(o,e){n("#bookingPostId").val()}),n(document).ready(function(){n("#current_price_box").length&&(n("#current_price_box_data").html(""),o.indiebookingGlobalFrontendUiController.showPartLoading("#current_price_box"))}),n(o).load(function(){l();var o=n("#booking_status_box_menu").attr("data-pageKz");2==o&&d()}),n(document).ready(function(a){n(document).on("click","#appartment_list_box .possibleOptionsTable .cb_choose_option",function(){o.indiebookingGlobalBookingController.updateBooking(-1)}),n(document).on("click","#appartment_list_box .appartmentOptionsBox .cb_choose_option",function(){var e=n(this).closest(".appartment_box").attr("data-appartmentid"),t=n(this).attr("data-optionid"),a=n(this).is(":checked"),i={apartmentid:e,optionId:t,checked:a};o.indiebookingGlobalBookingController.updateBooking(-1,i)}),n(document).on("change","#appartment_list_box .rs_ib_buchung_anzahl_personen",function(){o.indiebookingGlobalBookingController.updateBooking(-1)}),n("#page_content").on("click",".navbtnBookingInfo",function(o){var e=n("#booking_status_box_menu").attr("data-pageKz"),t=n(this).hasClass("navigate_possible");e>1&&t&&s(1)}),n("#page_content").on("click",".navbtnBookingContact",function(e){var t=n("#booking_status_box_menu").attr("data-pageKz"),a=n(this).hasClass("navigate_possible");t<2&&a?o.indiebookingGlobalBookingController.updateBooking(1):t>2&&a&&s(2)}),n("#page_content").on("click",".navbtnBookingOverview",function(e){var t=n("#booking_status_box_menu").attr("data-pageKz"),a=n(this).hasClass("navigate_possible");t<3&&a?o.indiebookingGlobalBookingController.updateBooking(2):t>3&&a&&s(3)}),n("#page_content").on("click","#btnAppartmentZahlungspflichtigBuchen",function(o){
o.preventDefault(),t()}),n(document).on("keypress","#apartment_coupon_code",function(o){13==o.keyCode&&b()}),n(document).on("click","#btnApplyCouponCode",function(){b()}),n(document).on("keypress","#apartment_coupon_code_small",function(o){13==o.keyCode&&u()}),n(document).on("click","#btnApplyCouponCode_small",function(){u()}),n("#page_content").on("click","#btnAppartmentSendInquirie",function(o){o.preventDefault(),g()}),n("#page_content").on("click",".btnSaveBooking",function(o){n("#rs_indiebooking_ppplus_container").length<=0&&(paymentMethod=n("input[type='radio'][name='rs_ib_Zahlmethode']:checked").val(),"paypal"!=paymentMethod&&"StripeSofort"!=paymentMethod&&"StripeGiropay"!=paymentMethod&&(o.preventDefault(),m()))}),n(document).on("change","#appartment_list_box .moreBookingInfoBox .booking_date_to",function(){var e=n(this).closest(".date_container").find(".booking_date_from");""!==e.val()&&""!==n(this).val()&&o.indiebookingDateUtil.getInstance().checkFromBiggerThanTo(e,n(this))&&(o.indiebookingGlobalBookingController.updateBooking(-1),C())}),n(document).on("change","#appartment_list_box .moreBookingInfoBox .booking_date_from",function(){var e=n(this).closest(".date_container").find(".booking_date_to");""!==e.val()&&""!==n(this).val()&&o.indiebookingDateUtil.getInstance().checkFromBiggerThanTo(n(this),n(e))&&(o.indiebookingGlobalBookingController.updateBooking(-1),C())}),n(".rs_opendrowdown_btn").on("click",function(o){v(n(this),"div")}),n("#page_content").on("click","#btnTestPreise",function(o){l()}),n("#rs_ib_btn_cancel_booking").on("click",function(){var o=n("#usercancel_email_adress").val(),e=n("#usercancel_bookingnumber").val();""!=o&&""!=e&&y(o,e)}),n(".btnAppartmentBuchen").on("click",function(o){o.preventDefault(),e(!0)}),n("#page_content").on("click",".btnCancelBooking",function(o){o.preventDefault(),f("")}),n(".main_container").on("click","nav.navbar a",function(o){o.preventDefault(),k(this.href)}),n("#page_content").on("click","footer a",function(o){n("body").hasClass("single-rsappartment_buchung")&&(o.preventDefault(),k(this.href))})}),{startBooking:e,finalizeBooking:t,updateBooking:i,getBookingInfos:r,showOutofTimeBookingDialog:p,countDownOutOfTimeWasShown:x}}(window,jQuery);window.indiebookingGlobalBookingController||(window.indiebookingGlobalBookingController=indiebookingGlobalBookingController),jQuery(document).ready(function(o){jQuery("#page_content").on("keyup","#rs_indiebooking_booking_custom_message",function(){var o=jQuery(this).val().length;o>=500?jQuery(this).val(jQuery(this).val().substring(0,501)):jQuery("#rs_indiebooking_charNum").find(".countable").text(500-o)}),jQuery("#page_content").on("change",".ibui_payment_radio_button",function(){jQuery(".ibui_payment_radio_button_box").removeClass("ibui_payment_radio_button_box_checked"),jQuery(this).is(":checked")?jQuery(this).closest(".ibui_payment_radio_button_box").addClass("ibui_payment_radio_button_box_checked"):jQuery(this).closest(".ibui_payment_radio_button_box").removeClass("ibui_payment_radio_button_box_checked")}),jQuery("#rs_ib_region_input").combobox({position:{my:"right top",at:"right bottom"}}),jQuery("#rs_ib_region_input2").combobox({position:{my:"right top",at:"right bottom"}}),window.indiebookingGlobalUiController.registerToggleListener(".main_container"),jQuery("input").on("focusin",function(){jQuery(this).data("prev_val",jQuery(this).val())}),jQuery(document).on("click",".rs_ib_not_sync_calendar",function(o){var n=!0;jQuery(this).is(":checked")&&(n=!1);var e=jQuery(this).closest("div").find(".item_kalender_small"),t=jQuery(e).find(".rs_zabuto-calendar");jQuery(t).data("syncDatePicker",n)}),jQuery("#page_content").on("click","#agb_link",function(o){o.preventDefault(),jQuery("#dialog_agb").dialog({autoOpen:!1,minHeight:200,maxHeight:600,maxWidth:600,minWidth:600,modal:!0,zIndex:1e4,resizable:!1,buttons:{schliessen:function(){jQuery(this).dialog("close")}},open:function(o,n){jQuery(this).dialog("option","maxHeight",600),jQuery(this).dialog("option","minHeight",200)},close:function(o,n){}}),jQuery("#dialog_agb").dialog("moveToTop"),jQuery("#dialog_agb").dialog("open")}),jQuery("#page_content").on("click","#ctrl_agree",function(o){jQuery("#rs_ib_buchung_zahlart").val();jQuery(this).is(":checked")&&jQuery("#ctrl_agree").popover("hide")})});