jQuery(document).ready(function(n){function i(){var n,i=jQuery("#indiebooking_mail_attachment"),e=jQuery("#indiebooking_settings_attachment_container");jQuery("#indiebooking_upload_mailAttachment-btn").on("click",function(t){var o=jQuery(this);return t.preventDefault(),n?void n.open():(n=wp.media({title:o.data("choose"),button:{text:o.data("update")},multiple:!0}),n.on("select",function(){var t=n.state().get("selection"),a=i.val();t.map(function(n){n=n.toJSON(),n.id&&(a=a?a+","+n.id:n.id,e.append('<li class="mailattachment ui-state-default" data-attachment_id="'+n.id+'"><span><span>'+n.filename+'</span><a href="#" class="delete tips glyphicon glyphicon-remove" title="'+o.data("delete")+'"></a></span></li>'))}),i.val(a)}),void n.open())}),jQuery("#indiebooking_settings_attachment_container").on("click","a.delete",function(){jQuery(this).closest("li.mailattachment").remove();var n="";return jQuery("#indiebooking_settings_attachment_container").find(".mailattachment").each(function(){var i=jQuery(this).attr("data-attachment_id");n=n+i+","}),i.val(n),!1})}function e(n){"undefined"!=typeof n&&0!=n||(n="");var i=jQuery.ajax({type:"POST",url:indiebooking_admin_settings_ajaxObject.ajaxURL,data:{action:"getIndiebookingLogFile",filename:n},beforeSend:function(){var n=[];jQuery("#logloading").show(),jQuery("#indiebooking-admin-settings-log-table").tabulator("setData",n)}});i.done(function(n,i,e){var t=[],o=JSON.parse(n.data);"undefined"!=typeof o&&o!==!1&&("info"in o&&jQuery.each(o.info,function(n,i){var e=[];e.index=n,e.type=i.type,e.msg=i.msg,e.date=i.date,t.push(e)}),"error"in o&&jQuery.each(o.error,function(n,i){var e=[];e.index=n,e.type=i.type,e.msg=i.msg,e.date=i.date,t.push(e)})),jQuery("#indiebooking-admin-settings-log-table").tabulator("setData",t)}),i.fail(function(n,i,e){alert(e)}),i.always(function(n,i,e){jQuery("#logloading").hide()})}jQuery("#btnPrintTestBooking").on("click",function(){var n=indiebooking_admin_settings_ajaxObject.ajaxURL;n=n.replace("admin-ajax.php","admin-post.php");var i;i=jQuery("<form />",{action:n,method:"POST",style:"display: none;"}),jQuery("<input />",{type:"hidden",name:"action",value:"printTestBooking"}).appendTo(i),i.appendTo("body").submit()}),jQuery("#btnSendTestBookingEmail").on("click",function(){var n=jQuery.ajax({type:"POST",url:indiebooking_admin_settings_ajaxObject.ajaxURL,data:{action:"indiebookingSendTestMail",security:indiebooking_admin_settings_ajaxObject.ib_ajax_nonce},beforeSend:function(){jQuery(document).trigger("showHideLoadingContext",[!0])}});n.done(function(n,i,e){}),n.fail(function(n,i,e){alert(e)}),n.always(function(n,i,e){jQuery(document).trigger("showHideLoadingContext",[!1])})}),jQuery("#wpbody").on("submit","form",function(){var n=!1;if(jQuery("#indiebooking_admin_email_settings_table").length>0){var i=jQuery("#indiebooking_admin_email_settings_table").find("input.ibui_input");jQuery.each(i,function(i,e){var t=jQuery(e).val();if(""!=t){if(n=window.indiebookingGlobalUiController.isValidEmailAddress(t),0==n)return!1}else n=!0}),0==n&&ibui_indiebooking_errorAdminDialog("Error","Please check the Admin E-Mail Data")}else n=!0;return n}),jQuery(".ibui_toggle_header").on("click",function(n){n.preventDefault();var i=jQuery(this).children(".glyphicon-chevron-up"),e=jQuery(this).children(".glyphicon-chevron-downsss");i.length?e.length||jQuery(this).find(".glyphicon-chevron-up").switchClass("glyphicon-chevron-up","glyphicon-chevron-down",1e3,"easeInOutQuad"):jQuery(this).find(".glyphicon-chevron-down").switchClass("glyphicon-chevron-down","glyphicon-chevron-up",1e3,"easeInOutQuad"),jQuery(this).next(".ibui_toggle_content").slideToggle("slow")}),i(),jQuery("#ibfc_btn_first_steps").on("click",function(){window.indiebookingGlobalAdminUiController.rs_indiebooking_setCookie("ibui_last_settings_tab","undefined")}),jQuery(".ibfc_toggle_mail_content_header").on("click",function(n){n.preventDefault();var i=jQuery(this).children(".glyphicon-chevron-up"),e=jQuery(this).children(".glyphicon-chevron-downsss");i.length?e.length||jQuery(this).find(".glyphicon-chevron-up").switchClass("glyphicon-chevron-up","glyphicon-chevron-down",1e3,"easeInOutQuad"):jQuery(this).find(".glyphicon-chevron-down").switchClass("glyphicon-chevron-down","glyphicon-chevron-up",1e3,"easeInOutQuad"),jQuery(this).next(".toggle_mail_content").toggle()}),jQuery("#rs_ib_admin_settings_view .ibui_tab_radio").on("change",function(){var n=jQuery(".ibui_tab_radio:checked").attr("id");window.indiebookingGlobalAdminUiController.rs_indiebooking_setCookie("ibui_last_settings_tab",n,1)}),jQuery("#rs_indiebooking_settings_future_availability").spinner({max:99,min:1,alignment:"horizontal"}),jQuery("#rs_indiebooking_settings_deposit_days").spinner({max:999,min:0,alignment:"horizontal"}),jQuery(".indiebooking_admin_payment_number_spinner").spinner({max:999,min:0,alignment:"horizontal"}),jQuery("#btn_save_indiebooking_settings").on("click",function(){var n=jQuery("#indiebooking_mwst_settings_table").find("input"),i=[];jQuery.each(n,function(n){var e=new Object;e.mwstid=jQuery(this).attr("data-mwstid"),e.mwst=jQuery(this).val(),i.push(e)}),jQuery.ajax({type:"POST",action:"saveOrUpdateSettings",url:indiebooking_admin_settings_ajaxObject.ajaxURL,data:{action:"saveOrUpdateSettings",mwsts:i,security:indiebooking_admin_settings_ajaxObject.ib_ajax_nonce},success:function(n,i,e){console.log(n),alert("OK")},error:function(n,i,e){alert(e)}})}),jQuery("#btn_add_refund").on("click",function(n){n.preventDefault();var i=jQuery("#rs_indiebooking_storno_nextId").val(),e=jQuery("#indiebooking_storno_settings_table").find("tbody").find("tr").first();i=parseInt(i)+1;var t="tempspinner_"+i,o="<input id='"+t+"' class='onlyInteger settings_admin_number_spinner ibui_input ibui_tooltip_item' name='rs_indiebooking_settings_storno["+i+"][days]' value='0' />";if("undefined"!=typeof e&&e!==!1){var a=jQuery(e).clone();jQuery(a).find("input").val(""),jQuery(a).find("td").first().find("input").attr("name","rs_indiebooking_settings_storno["+i+"][refund_value]"),jQuery(a).find("td:eq(1)").html(o),jQuery(a).find("#"+t).spinner({min:0,alignment:"horizontal"}),jQuery(a).find(".ibfk_admin_info_id").attr("name","rs_indiebooking_settings_storno["+i+"][id]"),jQuery(a).find(".ibfk_admin_info_id").val(i),jQuery("#indiebooking_storno_settings_table").find("tbody").prepend(a)}else{var r=document.getElementById("indiebooking_storno_settings_table"),s=r.insertRow(1),d=s.insertCell(0),l=s.insertCell(1),u=s.insertCell(2);d.innerHTML="<input class='ibui_input rs_indiebooking_settings_storno_satz onlyNumber given_price' value='' type='text' name='rs_indiebooking_settings_storno["+i+"][refund_value]'>",l.innerHTML="<input class='ibui_input rs_indiebooking_settings_storno_satz onlyNumber given_price' value='' type='text' name='rs_indiebooking_settings_storno["+i+"][days]'>",u.innerHTML="<input type='hidden' value='"+i+"' name='rs_indiebooking_settings_storno["+i+"][id]' >"}jQuery("#rs_indiebooking_storno_nextId").val(parseInt(i))}),jQuery("#btn_add_taxes").on("click",function(n){n.preventDefault();var i=document.getElementById("indiebooking_mwst_settings_table"),e=jQuery("#rs_indiebooking_mwst_nextId").val(),t=jQuery("#indiebooking_mwst_settings_table").find("tbody").find("tr").first();if(e=parseInt(e)+1,"undefined"!=typeof t&&t!==!1){var o=jQuery(t).clone();jQuery(o).find("input").val(""),jQuery(o).find("td").first().find("input").attr("name","rs_indiebooking_settings_mwst["+e+"][value]"),jQuery(o).find(".ibfk_admin_info_id").attr("name","rs_indiebooking_settings_mwst["+e+"][id]"),jQuery(o).find(".ibfk_admin_info_id").val(e),jQuery("#indiebooking_mwst_settings_table").find("tbody").prepend(o)}else{var a=i.insertRow(1),r=a.insertCell(0),s=a.insertCell(1);r.innerHTML="<input type='text' class='mwst_satz onlyNumber given_price' value='' name='rs_indiebooking_settings_mwst["+e+"][value]' >",s.innerHTML="<input type='hidden' value='"+e+"' name='rs_indiebooking_settings_mwst["+e+"][id]' >"}jQuery("#rs_indiebooking_mwst_nextId").val(parseInt(e))}),jQuery("#indiebooking_refresh_log").on("click",function(){e()}),jQuery(".indiebooking-log-file-link").on("click",function(){e(jQuery(this).attr("data-filename"))}),jQuery("#indiebooking-admin-settings-log-table").tabulator({layout:"fitData",initialSort:[{column:"index",dir:"desc"},{column:"date",dir:"desc"}],columns:[{title:"Index",field:"index",sortable:!0},{title:"Date",field:"date",sortable:!0},{title:"Typ",field:"type",sortable:!0},{title:"Message",field:"msg",width:"85%"}]}),e()});